<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TextCipher Pro - Final Edition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=Kanit:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --primary: #3b82f6;
            --accent: #8b5cf6;
            --success: #10b981;
            --text: #f8fafc;
            --text-dim: #94a3b8;
            --border: #334155;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: var(--bg); 
            color: var(--text); 
            margin: 0; padding: 0; 
        }

        .header {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px; text-align: center;
            border-bottom: 1px solid var(--border);
            position: sticky; top: 0; z-index: 100;
        }

        .header h1 { 
            margin: 0; font-family: 'Kanit', sans-serif; font-size: 20px; 
            background: linear-gradient(to right, #60a5fa, #a78bfa);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .container { padding: 15px; max-width: 600px; margin: 0 auto; }

        .card {
            background: var(--card); border-radius: 16px;
            padding: 20px; margin-bottom: 15px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3);
        }

        .label { 
            display: block; margin-bottom: 10px; font-weight: 600; 
            color: var(--text-dim); font-size: 14px;
        }

        textarea {
            width: 100%; height: 100px; padding: 12px;
            background: #0f172a; border: 2px solid var(--border);
            border-radius: 10px; color: white; font-size: 16px;
            resize: none; outline: none; transition: 0.2s;
        }
        textarea:focus { border-color: var(--primary); }

        /* Settings Table */
        .settings-list { margin-top: 10px; }
        .setting-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 0; border-bottom: 1px solid var(--border);
        }
        .setting-item:last-child { border-bottom: none; }

        .setting-info { display: flex; align-items: center; gap: 10px; }
        .setting-info span { font-size: 14px; font-weight: 500; }

        .counter-box {
            display: flex; align-items: center; gap: 5px;
            background: #0f172a; padding: 5px 8px; border-radius: 8px;
        }
        .counter-box label { font-size: 11px; color: var(--text-dim); }
        .input-num {
            width: 40px; background: transparent; border: none;
            color: #fbbf24; font-weight: bold; text-align: center; font-size: 15px;
        }

        .btn-main {
            width: 100%; padding: 16px; margin-top: 10px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border: none; border-radius: 12px; color: white;
            font-family: 'Kanit', sans-serif; font-size: 18px; font-weight: 600;
            cursor: pointer; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        .btn-main:active { transform: scale(0.98); }

        /* Result Popup */
        .overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85); display: none; z-index: 1000;
        }
        .popup {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--card); border-radius: 20px 20px 0 0;
            padding: 20px; max-height: 80vh; overflow-y: auto;
            z-index: 1001; transform: translateY(100%); transition: 0.3s;
        }
        .popup.active { transform: translateY(0); }

        .result-box {
            background: #0f172a; border-radius: 12px; padding: 15px;
            margin-bottom: 15px; border: 1px solid var(--border);
        }
        .editable-text {
            background: #1e293b; padding: 12px; border-radius: 8px;
            font-size: 16px; margin-bottom: 10px; outline: none;
            border: 1px dashed var(--border); min-height: 40px;
            word-break: break-all;
        }
        .editable-text:focus { border-color: var(--accent); background: #26334d; }

        .btn-copy {
            width: 100%; padding: 10px; background: var(--success);
            border: none; border-radius: 8px; color: white; font-weight: bold;
            cursor: pointer;
        }

        .toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: var(--success); color: white; padding: 8px 20px;
            border-radius: 20px; font-size: 14px; display: none; z-index: 2000;
        }
    </style>
</head>
<body>

<div class="header"><h1>TEXTCIPHER X: CUSTOM CONTROL</h1></div>

<div class="container">
    <div class="card">
        <span class="label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö</span>
        <textarea id="inputText" placeholder="‡πÄ‡∏ä‡πà‡∏ô 82/7 ‡∏´‡∏°‡∏π‡πà 4 ‡∏ñ.‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó..."></textarea>
    </div>

    <div class="card">
        <span class="label">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏° (‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)</span>
        <div class="settings-list">
            <div class="setting-item">
                <div class="setting-info">
                    <input type="checkbox" id="chkTone" checked>
                    <span>‡∏ß‡∏£‡∏£‡∏ì‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡∏´‡∏•‡∏≠‡∏Å (‡∏∫ ‡πà ‡πâ ‡πå) </span>
                </div>
                <div class="counter-box">
                    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</label>
                    <input type="number" id="numTone" class="input-num" value="3">
                </div>
            </div>
            <div class="setting-item">
                <div class="setting-info">
                    <input type="checkbox" id="chkInvis" checked>
                    <span>‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏•‡πà‡∏≠‡∏á‡∏´‡∏ô (‡∏ö‡∏≠‡∏ó‡∏á‡∏á)</span>
                </div>
                <div class="counter-box">
                    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</label>
                    <input type="number" id="numInvis" class="input-num" value="5">
                </div>
            </div>
            <div class="setting-item">
                <div class="setting-info">
                    <input type="checkbox" id="chkSpace" checked>
                    <span>‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ (‡∏´‡∏±‡πà‡∏ô‡∏Ñ‡∏≥)</span>
                </div>
                <div class="counter-box">
                    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</label>
                    <input type="number" id="numSpace" class="input-num" value="2">
                </div>
            </div>
        </div>
    </div>

    <button class="btn-main" id="btnProcess">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡∏≤‡∏á ‚ö°</button>
</div>

<div class="overlay" id="overlay"></div>
<div class="popup" id="popup">
    <div style="display:flex; justify-content:space-between; margin-bottom:15px; align-items:center;">
        <span style="font-weight:bold; font-size:18px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö</span>
        <span id="btnClose" style="color:#ef4444; font-weight:bold; cursor:pointer;">‡∏õ‡∏¥‡∏î</span>
    </div>
    <div style="font-size:12px; color:var(--text-dim); margin-bottom:15px; background:rgba(251,191,36,0.1); padding:8px; border-radius:5px;">
        üí° ‡∏à‡∏¥‡πâ‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏¢‡∏≤‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!
    </div>
    <div id="resultsList"></div>
</div>

<div class="toast" id="toast"></div>

<script>
    const MARKS_TONE = ['\u0E3A', '\u0E48', '\u0E49', '\u0E4C']; // ‡∏∫ , ‡πà , ‡πâ , ‡πå
    const MARKS_INVIS = ['\u200B', '\u200C', '\u200D'];

    function getRandomSample(arr, n) {
        let shuffled = [...arr].sort(() => 0.5 - Math.random());
        return shuffled.slice(0, n);
    }

    function processCipher() {
        const input = document.getElementById('inputText').value;
        if (!input) return alert('‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏à‡πâ‡∏≤');

        const config = {
            tone: { active: document.getElementById('chkTone').checked, count: parseInt(document.getElementById('numTone').value) || 0 },
            invis: { active: document.getElementById('chkInvis').checked, count: parseInt(document.getElementById('numInvis').value) || 0 },
            space: { active: document.getElementById('chkSpace').checked, count: parseInt(document.getElementById('numSpace').value) || 0 }
        };

        const resultsContainer = document.getElementById('resultsList');
        resultsContainer.innerHTML = '';

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á 3 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        for (let i = 1; i <= 3; i++) {
            let tempArray = input.split('');

            // 1. ‡∏ß‡∏£‡∏£‡∏ì‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡∏´‡∏•‡∏≠‡∏Å (‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢)
            if (config.tone.active && config.tone.count > 0) {
                let targets = [];
                tempArray.forEach((char, idx) => { if (/[0-9\/\-]/.test(char)) targets.push(idx); });
                if (targets.length === 0) targets = tempArray.map((_, idx) => idx); // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡πÄ‡∏•‡∏¢ ‡πÉ‡∏´‡πâ‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏™‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ

                let chosen = getRandomSample(targets, config.tone.count);
                chosen.forEach(idx => {
                    tempArray[idx] += MARKS_TONE[Math.floor(Math.random() * MARKS_TONE.length)];
                });
            }

            // 2. ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ (‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°)
            if (config.space.active && config.space.count > 0) {
                let targets = [];
                tempArray.forEach((char, idx) => { if (char !== ' ') targets.push(idx); });
                let chosen = getRandomSample(targets, config.space.count);
                chosen.forEach(idx => { tempArray[idx] += ' '; });
            }

            // 3. ‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏•‡πà‡∏≠‡∏á‡∏´‡∏ô (‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ)
            if (config.invis.active && config.invis.count > 0) {
                let targets = Array.from({length: tempArray.length}, (_, i) => i);
                let chosen = getRandomSample(targets, config.invis.count);
                chosen.forEach(idx => {
                    tempArray[idx] += MARKS_INVIS[Math.floor(Math.random() * MARKS_INVIS.length)];
                });
            }

            addResultItem(tempArray.join(''), i);
        }

        showPopup();
    }

    function addResultItem(text, idx) {
        const div = document.createElement('div');
        div.className = 'result-box';
        div.innerHTML = `
            <div style="font-size:12px; color:var(--text-dim); margin-bottom:5px;">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà ${idx}</div>
            <div class="editable-text" contenteditable="true" id="res-${idx}">${text}</div>
            <button class="btn-copy" onclick="copyText('res-${idx}', this)">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà ${idx}</button>
        `;
        document.getElementById('resultsList').appendChild(div);
    }

    function showPopup() {
        document.getElementById('overlay').style.display = 'block';
        const p = document.getElementById('popup');
        p.style.display = 'block';
        setTimeout(() => p.classList.add('active'), 10);
    }

    function hidePopup() {
        const p = document.getElementById('popup');
        p.classList.remove('active');
        setTimeout(() => {
            p.style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }, 300);
    }

    function copyText(elId, btn) {
        const text = document.getElementById(elId).innerText;
        navigator.clipboard.writeText(text).then(() => {
            const old = btn.innerText;
            btn.innerText = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!';
            btn.style.background = '#059669';
            showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏á Clipboard ‡πÅ‡∏•‡πâ‡∏ß ‚ú®');
            setTimeout(() => { 
                btn.innerText = old; 
                btn.style.background = 'var(--success)';
            }, 1500);
        });
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg; t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 2000);
    }

    document.getElementById('btnProcess').onclick = processCipher;
    document.getElementById('btnClose').onclick = hidePopup;
    document.getElementById('overlay').onclick = hidePopup;
</script>

</body>
</html>
